function base64(e){var t;var n=new Image,r=document.createElement("canvas"),i=r.getContext("2d"),s=e;n.crossOrigin="Anonymous";n.onload=function(){r.height=n.height;r.width=n.width;i.drawImage(n,0,0);var e=r.toDataURL("image/png");r=null;preload(e)};n.src=e}function extractToken(e){var t=e.match(/access_token=(\w+)/);return!!t&&t[1]}function handleData(e){$.each(e.data,function(t,n){if(e.data[t].animated===false)if(e.data[t].is_album===false){ajaxlength.push({imageamount:valueajax++});var r=n.link;var i=preload(r)}})}function onFrame(e){if(clearCanvas&&project.activeLayer.hasChildren()){project.activeLayer.removeChildren();clearCanvas=false}}function onMouseDown(e){if(press===0){if(!loaded)return;init();path.position=e.point;path2.position=e.point}}function onMouseMove(e){if(press===0){if(!loaded)return;var t=e.delta;t.angle=t.angle+270;stepReci=t.normalize()*200*(1/t.length);var n=e.middlePoint+stepReci;var r=e.middlePoint-stepReci;carryLength=carryLength+t.length;if(carryLength>stepReci.length){path.add(n);path.insert(0,r);path.smooth();path2.add(n);path2.insert(0,r);path2.smooth();carryLength=0}}}function init(){if(cache.length){var e=value++;var t=true;if(e==imgurcache.length-15)getMoreImages();var n=cache.shift();autoShowNext=false;r=new Raster(n.source);r.position=view.center;r.size=view.bounds;r.on("load",function(){onResize()});rArray.push(r);path=new Path.Circle;path2=new Path.Circle({fillColor:"black",shadowColor:"black",shadowBlur:32});path.position=view.center;path2.position=view.center;g=new Group([path,r]);g.clipped=true}else autoShowNext=true}function preload(e){imgun=e===undefined;imgurcache.push({image:e});var t=Math.round(Number(imgurcache.length)/Number(ajaxlength.length)*100);var n=Number(imgurcache.length);var r=Number(ajaxlength.length);if(t>=0&&t<=100){$("#bar").css("width",t+"%")}if(n==r)setTimeout(function(){$("#preloader").fadeOut(250);$("#bar").fadeOut(250);$("#bar").css("width",0);t=0},5e3);var i=new Image;i.onload=function(){cache.push({source:i,position:view.center,size:view.bounds});if(cache.length<preloadAmount)preload();if(autoShowNext)init()};if(!imgun)i.src=e;if(imgurcache.length==2)start()}function start(){raster=new Raster(imgurcache[0].image);raster.position=view.center;raster.size=view.bounds;raster.on("load",function(){loaded=true;onResize()});path=new Path.Circle;path2=new Path.Circle({fillColor:"black",shadowColor:"black",shadowBlur:12});g=new Group([path,raster]);g.clipped=true}function onResize(e){if(background)background.fitBounds(view.bounds,true);if(raster)raster.fitBounds(view.bounds,true);if(rArray.length)rArray.forEach(function(e){e.fitBounds(view.bounds,true);e.position=view.center})}function getMoreImages(){function e(e){var t=e.match(/access_token=(\w+)/);return!!t&&t[1]}function s(e){$.each(e.data,function(t,n){if(e.data[t].animated===false)if(e.data[t].is_album===false){ajaxlength.push({imageamount:valueajax++});var r=n.link;var i=preload(r)}})}var t=Math.floor(Math.random()*50);var n=e(document.location.hash);var r="b144351ffb05838";var i;if(n)authorization="Bearer "+n;else authorization="Client-ID "+r;$.ajax({url:"https://api.imgur.com/3/gallery/random/random/page="+t,method:"GET",headers:{Authorization:authorization,Accept:"application/json"},crossDomain:true,data:{image:localStorage.dataBase64,type:"base64"},beforeSend:function(){$("#preloader").css("display","block")},success:s})}var r,path,raster,background,imagesrc;var preloadAmount=10;var cache=[];var imgurcache=[];var rArray=[];var convertedArray=[];var ajaxlength=[];var autoShowNext=false;var loaded=false;var value=isNaN(value)?0:value;var valueajax=isNaN(valueajax)?0:valueajax;var press=isNaN(press)?0:press;var cvs=document.getElementById("mycanvas");var canvas_options_form=document.getElementById("canvas-options");var canvas_filename=document.getElementById("canvas-filename");var pre=document.getElementById("preloader");var clearCanvas=false;var num=Math.floor(Math.random()*50);var token=extractToken(document.location.hash);var clientId="b144351ffb05838";var auth;if(token)authorization="Bearer "+token;else authorization="Client-ID "+clientId;$.ajax({url:"https://api.imgur.com/3/gallery/random/random/page="+num,method:"GET",headers:{Authorization:authorization,Accept:"application/json"},crossDomain:true,data:{image:localStorage.dataBase64,type:"base64"},beforeSend:function(){$("#preloader").css("display","block")},success:handleData});init();var carryLength=0;$(document).keyup(function(e){if(pre.style.display=="none"){var t=$("#outerTools");var n=$("#innerTools");if(e.keyCode==32){press++;if(press===1){var r=cvs.toDataURL("image/png");document.getElementById("myImg").src=r;t.show()}if(press===2){t.hide();press=0}$("#outerTools").on("click",function(e){press=0;t.hide();return false});$("#info").bind("click",function(e){e.stopPropagation()});$("#saveImage").bind("click",function(e){e.stopPropagation()});$(".centerImage").bind("click",function(e){e.stopPropagation()})}}});$("#saveImage").on("click",function(){var e=cvs.toDataURL("image/png");document.getElementById("myImg").src=e;cvs.toBlob(function(t){saveAs(t,(canvas_filename.value||canvas_filename.placeholder)+".png");$.ajax({type:"POST",data:{imagetosave:e},url:"saveimage.php",success:function(e){}})},"image/png");return false})